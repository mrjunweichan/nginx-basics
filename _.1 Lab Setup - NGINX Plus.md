  
  
---
## Setup
  
**Create directory to put trial license for attendees**  
```shell
sudo mkdir -p /home/ubuntu/nginx-one-license/
```
  
**Create index.html files for 3 Applications**  
```shell
sudo mkdir -p /opt/services/App1/
sudo mkdir -p /opt/services/App2/
sudo mkdir -p /opt/services/App3/
sudo touch /opt/services/App1/index.html
sudo touch /opt/services/App2/index.html
sudo touch /opt/services/App3/index.html
```
  
**Create App1**
```shell
cat <<EOF >>/opt/services/App1/index.html
<!doctype html>
<html lang="en-US">

<head>
    <link rel="icon" type="image/png"
          href="https://www.nginx.com/wp-content/uploads/2019/10/favicon-48x48.ico" sizes="48x48">

    <h1>This is my APP 1</h1>
    <style>
        body { background-color: #FF0000; }
    </style>
    <title>RED - APP 1</title>
</head>

</html>
EOF
```
  
**Create App2**  
```shell
cat <<EOF >>/opt/services/App2/index.html
<!doctype html>
<html lang="en-US">

<head>
    <link rel="icon" type="image/png"
          href="https://www.nginx.com/wp-content/uploads/2019/10/favicon-48x48.ico" sizes="48x48">

    <h1>This is my APP 2</h1>
    <style>
        body { background-color: #00FF00; }
    </style>
    <title>GREEN - APP 2</title>
</head>

</html>
EOF
```
  
**Create App3**  
```shell
cat <<EOF >>/opt/services/App3/index.html
<!doctype html>
<html lang="en-US">

<head>
    <link rel="icon" type="image/png"
          href="https://www.nginx.com/wp-content/uploads/2019/10/favicon-48x48.ico" sizes="48x48">

    <h1>This is my APP 3</h1>
    <style>
        body { background-color: #0000FF; }
    </style>
    <title>BLUE - APP 3</title>
</head>

</html>
EOF
```
  
  
---
## TLS certs
  
  
**Generate self-signed cert**  
```shell
sudo mkdir -p /opt/ssl/

cd /opt/ssl

openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout www.example.com.key -out www.example.com.crt
```


---
## mTLS certs
  
**Create own CA**  
```shell
sudo mkdir -p /opt/ssl/

cd /opt/ssl

# Generate the CA's private key
openssl genrsa -out ca-key.pem 4096

# Create the CA certificate (valid for 10 years)
openssl req -x509 -new -nodes -key ca-key.pem \
  -sha256 -days 3650 -out ca-cert.pem \
  -subj "/CN=PrivateCA"
```
  
**Generate server cert signed by CA**  
```shell
# Generate private key for NGINX
openssl genrsa -out server-key.pem 2048

# Create a certificate signing request
openssl req -new -key server-key.pem -out server.csr \
  -subj "/CN=example.api"

# Sign the server cert with your CA
openssl x509 -req -in server.csr \
  -CA ca-cert.pem -CAkey ca-key.pem -CAcreateserial \
  -out server-cert.pem -days 365 -sha256
```
  
**Generate client cert signed by CA**  
```shell
# Generate client's private key
openssl genrsa -out client-key.pem 2048

# Create client CSR
openssl req -new -key client-key.pem -out client.csr \
  -subj "/CN=trusted-client"

# Sign client cert using your CA
openssl x509 -req -in client.csr \
  -CA ca-cert.pem -CAkey ca-key.pem -CAcreateserial \
  -out client-cert.pem -days 365 -sha256
```
  
**p12 bundle for firefox**  
```shell
openssl pkcs12 -export \
  -inkey client-key.pem \
  -in client-cert.pem \
  -certfile ca-cert.pem \
  -out client-cert.p12
```
  
  
---
## **Move client cert to Host machine**  
  
  
**Update ownership of client cert**  
```shell
cp client-cert.p12 /home/ubuntu/client-cert.p12
sudo chown ubuntu:ubuntu /home/ubuntu/client-cert.p12
```
  
**Export client cert to (Host Machine)**
```
scp -O -P 47002 ubuntu@xxxx-xxxx-xxxx-xxxx.access.udf.f5.com:/home/ubuntu/client-cert.p12 ~/Desktop
```
