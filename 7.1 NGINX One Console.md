

## Step 1: NGINX One Console

**Create Dataplane Key**

**NGINX ONE Console > Manage > Data Plane Keys**
>	Select: Add Data Plane Key  
>	Enter: Name  
>	Enter: Expiration Date  
>	Select: Generate  
>	Save: Data plane key


---

## Step 2a: NGINX Plus

**Pre-requisite**
NGINX Plus Installed
NGINX Agent Installed
Create data plane key from NGINX One Console

##### Step 1:

**Enable NGINX Metrics**
```sh title:"/etc/nginx/conf.d/nginx-metrics.conf"
cat <<EOF >>/etc/nginx/conf.d/nginx-metrics.conf
server {
    server_name nginx-metrics;
    listen 9000 default_server;

    location /api/ {
        api write=on;
    }
    
    location = /dashboard.html {
        root /usr/share/nginx/html;
    }
}
EOF
```
##### Step 2:
```sh title:"Add instance to N One"
# Manual
curl https://agent.connect.nginx.com/nginx-agent/install | DATA_PLANE_KEY="<nginx-one-dataplane-key>" sh -s -- -y

# From File
curl https://agent.connect.nginx.com/nginx-agent/install | DATA_PLANE_KEY="$(cat /home/ubuntu/nginx-dataplane-key.txt)" sh -s -- -y 
```


---

## Step 2b: NGINX Ingress Controller

**Pre-requisite**
NGINX Ingress Controller Installed
Create data plane key from NGINX One Console
##### Step 1:
Create a secret with the data plane key. Use the same namespace as NGINX Ingress Controller.
```bash
kubectl create secret generic dataplane-key --from-literal=dataplane.key=<nginx-one-dataplane-key>= -n nginx-ingress
```
##### Step 2:
Upgrade or install NGINX Ingress Controller with the following command to configure NGINX Agent and connect to NGINX One Console:
```bash
helm upgrade nic oci://ghcr.io/nginx/charts/nginx-ingress \
--version 2.2.0 \
--set nginxAgent.enable=true \
--set nginxAgent.dataplaneKeySecretName=dataplane-key \
--set nginxAgent.endpointHost=agent.connect.nginx.com \
--namespace nginx-ingress
```

