


## SSL Termination
  
**Copy self-signed certs to NGINX**  
```nginx
sudo mkdir /etc/nginx/ssl

sudo cp /opt/ssl/www.example.com.* /etc/nginx/ssl
```
  
**/etc/nginx/conf.d/api_gateway.conf**  
```nginx
upstream pet-store {
    zone api_upstreams 64k;
    server 10.1.1.4:80;
}

server {
    listen 443 ssl;
    ssl_certificate     /etc/nginx/ssl/www.example.com.crt;
    ssl_certificate_key /etc/nginx/ssl/www.example.com.key; 
    ssl_protocols TLSv1.3 TLSv1.2 TLSv1.1;
    ssl_prefer_server_ciphers on;
    
    location /pet-store-api/ {
        proxy_pass http://pet-store/v2/;
        proxy_set_header Host $host;
    }
}
```

> **listen 443 ssl** – listen for HTTP traffic on port 443, enable TLS encryption for this block  
> 
> **ssl_certificate** – server public cert presented during handshake  
> **ssl_certificate_key** – server private key matching server public cert  
> 
> **ssl_protocols** – define which TLS versions are allowed for incoming connection  
> **ssl_prefer_server_ciphers** – force NGINX (not client) to choose the cipher suite  

**Example** (modern ssl ciphers):  
> ssl_ciphers 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:  
 >             ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:  
 >             ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:  
 >             ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:  
 >             ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256';  
> ssl_prefer_server_ciphers on;  


---
## mTLS
  
**Copy server and ca certs to NGINX**  
```shell
sudo cp /opt/ssl/server-cert.pem /etc/nginx/ssl/
sudo cp /opt/ssl/server-key.pem /etc/nginx/ssl/
sudo cp /opt/ssl/ca-cert.pem /etc/nginx/ssl/
```
  
**/etc/nginx/conf.d/api_gateway.conf**  
```nginx
upstream pet-store {
    zone api_upstreams 64k;
    server 10.1.1.4:80;
}
server {
    listen 443 ssl;
    server_name example.api;
    
    ssl_certificate        /etc/nginx/ssl/server-cert.pem;
    ssl_certificate_key    /etc/nginx/ssl/server-key.pem;
    
    ssl_client_certificate /etc/nginx/ssl/ca-cert.pem;
    ssl_verify_client on;
    ssl_verify_depth 2;
    
    location /pet-store-api/ {
        proxy_pass http://pet-store/v2/;
        proxy_set_header Host $host;
    }
}
```
  
**Curl from Web Shell**  
```
curl -k https://example.api/pet-store-api/pet/1 \
  --cert /opt/ssl/client-cert.pem \
  --key /opt/ssl/client-key.pem \
  --cacert /opt/ssl/ca-cert.pem
```

---

> **Best Practice**
> It is best practice to always use the Highest version of Protocol and Highest strength encryption Ciphers at all times

Given the vast variety of HTTP clients, you may have to "downgrade" your NGINX web server TLS configurations to accommodate less secure environments

`dhparam` Diffie-Hellman parameters


```shell title:"Test SSL"
curl -k  https://localhost:443/pet-store-api/pet/1
```


