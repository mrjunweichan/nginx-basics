

## NGINX Instance Manager


---
## Offline Installation

### Step 1: Download SSL Cert and Private Key from MyF5 (Connected)
1. Login to **MyF5**
2. **My Products & Plans > Subscriptions**
3. Select **Subscription ID**
4. Download **SSL Certificate** and **Private Key** files

```
home/ubuntu/nginx-one-license/nginx-repo.crt
home/ubuntu/nginx-one-license/nginx-repo.key
```
### Step 2: Package NGINX Instance Manager (Connected)
1. Download **install-nim-bundle.sh** script
2. Run install script in `offline` mode

**Packaging Command**
```sh
sudo bash install-nim-bundle.sh \
-c /home/ubuntu/nginx-one-license/nginx-repo.crt \
-k /home/ubuntu/nginx-one-license/nginx-repo.key \
-m offline \
-d ubuntu22.04
```

**Output**: nim-oss-ubuntu22.04.tar.gz

### Step 3: Copy Tarball + Script + SSL files to target system (Disconnected)
There are OS dependencies we have for NGINX, NIM and Clickhouse. In offline mode we package only NGINX, NIM and Clickhouse packages, customers should first install OS dependencies also. Below are the dependencies list for Linux distributions with `.deb` (Debian/Ubuntu) and `.rpm` (Red Hat) packages. In online mode, these dependencies are auto resolved and installed.

**Debian/Ubuntu and similar operating systems**
- NGINX : libc6, libcrypt1, libpcre2-8-0, libssl3, zlib1g,lsb-base
- NIM : openssl, rsyslog, systemd, tar, lsb-release, openssl, gawk
- ClickHouse: libcap2-bin

**Red Hat-based operating systems**
- NGINX : bash, glibc, libxcrypt, openssl-libs, glibc, pcre2, openssl-libs, zlib, procps-ng, glibc , shadow-utils, systemd
- NIM : glibc, openssl, rsyslog,systemd, tar, which,zlib, yum-utils
- ClickHouse: None

Find the latest dependencies with one of the following commands:
- Ubuntu/Debian: apt-cache depends <package_name>=
- Red Hat : yum deplist

**Install NIM from tarball**
```shell
sudo bash install-nim-bundle.sh \
-m offline \
-i /home/ubuntu/nim-oss-ubuntu22.04.tar.gz \
-c /home/ubuntu/nginx-one-license/nginx-repo.crt \
-k /home/ubuntu/nginx-one-license/nginx-repo.key \
-d ubuntu22.04
```

### Step 4: Save the Admin Password (Disconnected)
```sh
Admin username: admin
Regenerated Admin password: jBdWk97AlWIBUd9IoQQTUuaZDMZEiV
```
### Step 5: Set operation mode to Disconnected (Disconnected)
1. Open `/etc/nms/nms.conf`
2. Update `integrations:license` with below
3. Restart NGINX Instance Manager

**/etc/nms/nms.conf**
```yaml
integrations:
    license:
        mode_of_operation: disconnected
```

**Restart NIM**
```sh
sudo systemctl restart nms
```

### Step 6: Login to NGINX Instance Manager (Disconnected)
```txt
https://<NIM-FQDN>
```


---

## Add license and submit initial usage report - Web Interface

**Add License**  
1. Go to the FQDN of your NGINX Instance Manager host and log in  
2. **Settings** > **Licenses**
	`https://<NIM_FQDN>/ui/settings/license`  
3. Select **Get Started**  
4. Upload your license file  
	**Browse**  
		OR  
	Dragging the file into the form  
5. Select **Add**  

**Download the initial usage report to send to F5**  
1. **Settings** > **License**  
2. Select **Download License Report**  
3. Submit usage report to F5  

**Submit the usage report to F5 for verification**  
```shell
curl --location 'https://product.apis.f5.com/ee/v1/entitlements/telemetry/bulk' \
--header "Authorization: Bearer $(cat /srv/firefox/nginx-repo.jwt)" \
--form 'file=@"/srv/firefox/downloads/Usage.zip"'
```

After running this command, look for the "statusLink" in the response. The `report-id` is the last part of the "statusLink" value (the UUID). For example:  
```json
{"statusLink":"/status/XXXXXXXX-1234-1234-1234-AAAAAAAAAAAA"}
```

**Save report-id**
In this example, the `report-id` is `XXXXXXXX-1234-1234-1234-AAAAAAAAAAAA`  
    
**Check the status of the usage acknowledgment**  
Replace `<report-id>` with your specific ID from the previous response  
```shell
curl --location 'https://product.apis.f5.com/ee/v1/entitlements/telemetry/bulk/status/<replace-with-report-id>' \
--header "Authorization: Bearer $(cat /srv/firefox/nginx-repo.jwt)"
```
    
**Download the usage acknowledgement from F5**  
```shell
curl --location 'https://product.apis.f5.com/ee/v1/entitlements/telemetry/bulk/download/<replace-with-report-id>' \
--header "Authorization: Bearer $(cat /srv/firefox/nginx-repo.jwt)" \
--output /srv/firefox/acknowledgement.zip
```


**Upload usage acknowledge to NGINX Instance Manager**  
1. **Settings** > **License**  
2. Select **Upload Usage Acknowledgement**  
3. Upload acknowledgement  
	**Browse**  
		OR  
	Dragging the file into the form  
4. Select **Add**  


---
## Add license and submit initial usage report - Script

**license_usage_offline.sh**  
[Download license_usage_offline.sh script](https://docs.nginx.com/scripts/license_usage_offline.sh)  

**Change script permissions**  
```sh
chmod +x /home/ubuntu/license_usage_offline.sh
```

**Run Script**  
```sh
./license_usage_offline.sh \
  -j /home/ubuntu/nginx-one-license/license.jwt \
  -i <nim-ip-address> \
  -u admin \
  -p <admin-password> \
  -s initial
```


---

## Online Installation

**Pre-requisites**  
NGINX Plus .cert and .key saved in:  
- `/etc/ssl/nginx/nginx-repo.crt`  
- `/etc/ssl/nginx/nginx-repo.key`  

**Security considerations**  
To ensure that your NGINX Instance Manager deployment remains secure, follow these recommendations:  
- Install NGINX Instance Manager on a dedicated machine (bare metal, container, cloud, or VM)  
- Ensure that no other services are running on the same machine  

**install-nim-bundle.sh**  
[Download install-nim-bundle.sh script](https://docs.nginx.com/scripts/install-nim-bundle.sh)  

**Install NIM**  
```shell
sudo bash install-nim-bundle.sh \
  -c /home/ubuntu/nginx-one-license/nginx-repo.crt \
  -k /home/ubuntu/nginx-one-license/nginx-repo.key \
  -p \
  -d ubuntu22.04 \
  -j /home/ubuntu/nginx-one-license/nginx-repo.jwt
```
>	`-c` Path to CRT  
>	`-k` Path to KEY  
>	`-j` Path to JWT  
>	`-p` Install NGINX Plus as API GW  
>	`-d` Distribution  

**Save Regenerated Admin password**  
```sh
...
Starting NGINX Instance Manager...
Success: ' systemctl start nms' completed successfully.
Installation is complete

Regenerated Admin password: XXXXXXXXXXXXXXXXXXXXXXXXXX

NGINX Instance Manager Successfully Started
```


---

## Uninstall NIM

```sh
sudo apt-get remove -y nms-*
sudo systemctl stop clickhouse-server
sudo apt-get remove -y clickhouse-server
```

